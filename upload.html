<!DOCTYPE html>
<html>
<head>
<title>Upload Video</title>
<style>
body { font-family:Poppins,sans-serif; text-align:center; padding:40px; }
input, button { padding:12px; margin:10px; }
button { background:#2563eb; color:#fff; border:none; border-radius:8px; }
#progress { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>Upload Your Video</h2>
<input type="file" id="videoFile" accept="video/*">
<button onclick="uploadVideo()">Upload</button>
<p id="progress"></p>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCpr9MXotr-M7noA7G28irleItKUELCY8Q",
  authDomain: "vibe-tribe-d5138.firebaseapp.com",
  projectId: "vibe-tribe-d5138",
  storageBucket: "vibe-tribe-d5138.appspot.com"
});

const storage = firebase.storage();
const db = firebase.firestore();
const auth = firebase.auth();

function uploadVideo(){
  const file = document.getElementById("videoFile").files[0];
  if(!file) return alert("Choose a video!");

  const user = auth.currentUser;
  const fileName = user.uid + "_" + Date.now() + ".mp4";
  const ref = storage.ref("videos/" + fileName);

  const uploadTask = ref.put(file);

  uploadTask.on("state_changed",
    (snapshot)=>{
      let progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
      document.getElementById("progress").textContent = "Uploading: " + Math.round(progress) + "%";
    },
    (error)=>{ alert(error.message); },
    ()=>{
      uploadTask.snapshot.ref.getDownloadURL().then(async (url)=>{
        await db.collection("videos").add({
          url: url,
          user: user.uid,
          time: Date.now()
        });
        alert("Video uploaded!");
        window.location.href = "videos.html";
      });
    }
  );
}
</script>

</body>
</html>
